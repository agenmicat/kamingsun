<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  {# absolute base url #}
  {% set siteUrl = "" %}
  {% if site and site.url %}
    {% set siteUrl = site.url %}
  {% endif %}
  {% set canonical = siteUrl + page.url %}
  
  {% set siteName = "AgenMicat" %}
  {% if site and site.name %}
    {% set siteName = site.name %}
  {% endif %}

  {% set pageTitle = siteName %}
  {% if title %}
    {% set pageTitle = title + " · " + siteName %}
  {% endif %}
  {% if title and video %}
    {% set pageTitle = "Nonton Video " + title + " di " + siteName %}
  {% endif %}
  <title>{{ pageTitle }}</title>

  {% set metaDesc = "Blog video " + siteName + " – kumpulan video pilihan, tutorial, dan hiburan." %}
  {% if title and video %}
    {% set metaDesc = "Anda sedang menonton video " + title + " di website " + siteName + "." %}
  {% endif %}
  {% if description %}
    {% set metaDesc = description %}
  {% endif %}
  <meta name="description" content="{{ metaDesc }}">

  <link rel="canonical" href="{{ canonical }}" />
  <link rel="stylesheet" href="/assets/style.css" />

  {# Open Graph #}
  {% set ogTitle = "AgenMicat" %}
  {% if title %}
    {% set ogTitle = title %}
  {% endif %}

  {% set ogDesc = metaDesc %}

  {% set ogImage = "" %}
  {% if thumbnail %}
    {% set ogImage = thumbnail %}
  {% endif %}

  {# provider fallback thumbnail #}
  {% if (not ogImage) and video and video.provider == "youtube" and video.id %}
    {% set ogImage = "https://i.ytimg.com/vi/" + video.id + "/hqdefault.jpg" %}
  {% endif %}
  {% if (not ogImage) and video and video.provider == "cloudflare" and video.id %}
    {% set ogImage = "https://videodelivery.net/" + video.id + "/thumbnails/thumbnail.jpg" %}
  {% endif %}

  {% if not ogImage %}
    {% set ogImage = siteUrl + "/assets/og-default.jpg" %}
  {% endif %}

  {% set ogType = "website" %}
  {% if video %}
    {% set ogType = "video.other" %}
  {% endif %}

  <meta property="og:type" content="{{ ogType }}" />
  <meta property="og:title" content="{{ ogTitle }}" />
  <meta property="og:description" content="{{ ogDesc }}" />
  <meta property="og:url" content="{{ canonical }}" />
  <meta property="og:image" content="{{ ogImage }}" />
  {# ================= Schema.org VideoObject (JSON-LD) ================= #}
  {% if video and title %}
    {% set siteUrl = "" %}
    {% if site and site.url %}{% set siteUrl = site.url %}{% endif %}
    {% set pageUrl = siteUrl + page.url %}

    {# description fallback (kalau tidak diisi) #}
    {% set schemaDesc = description %}
    {% if not schemaDesc %}
      {% set siteName = "AgenMicat" %}
      {% if site and site.name %}{% set siteName = site.name %}{% endif %}
      {% set schemaDesc = "Anda sedang menonton video " + title + " di website " + siteName + "." %}
    {% endif %}

    {# thumbnail fallback (universal) #}
    {% set schemaThumb = thumbnail %}
    {% if (not schemaThumb) and video.provider == "youtube" and video.id %}
      {% set schemaThumb = "https://i.ytimg.com/vi/" + video.id + "/hqdefault.jpg" %}
    {% endif %}
    {% if (not schemaThumb) and video.provider == "cloudflare" and video.id %}
      {% set schemaThumb = "https://videodelivery.net/" + video.id + "/thumbnails/thumbnail.jpg" %}
    {% endif %}
    {% if schemaThumb and schemaThumb[0] == "/" %}
      {% set schemaThumb = siteUrl + schemaThumb %}
    {% endif %}

    {# embedUrl/contentUrl sesuai provider #}
    {% set embedUrl = "" %}
    {% set contentUrl = "" %}

    {% if video.provider == "youtube" and video.id %}
      {% set embedUrl = "https://www.youtube.com/embed/" + video.id %}
    {% elif video.provider == "cloudflare" and video.id %}
      {% set embedUrl = "https://iframe.videodelivery.net/" + video.id %}
    {% elif video.provider == "bunny" and video.zone and video.id %}
      {% set embedUrl = "https://iframe.mediadelivery.net/embed/" + video.zone + "/" + video.id %}
    {% elif video.provider == "self" and video.src %}
      {% set contentUrl = video.src %}
      {% if contentUrl[0] == "/" %}
        {% set contentUrl = siteUrl + contentUrl %}
      {% endif %}
    {% endif %}

    {# uploadDate + duration optional #}
    {% set uploadDate = "" %}
    {% if created %}{% set uploadDate = created | isoDateTime %}{% endif %}

    {% set durIso = "" %}
    {% if duration %}{% set durIso = duration | isoDuration %}{% endif %}

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "VideoObject",
      "name": {{ title | dump }},
      "description": {{ schemaDesc | dump }},
      "thumbnailUrl": [ {{ schemaThumb | dump }} ],
      "url": {{ pageUrl | dump }}{% if uploadDate %},
      "uploadDate": {{ uploadDate | dump }}{% endif %}{% if durIso %},
      "duration": {{ durIso | dump }}{% endif %}{% if embedUrl %},
      "embedUrl": {{ embedUrl | dump }}{% endif %}{% if contentUrl %},
      "contentUrl": {{ contentUrl | dump }}{% endif %}
    }
    </script>
  {% endif %}

</head>

<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <h1>AgenMicat</h1>
        <small>Koleksi Video Viral</small>
      </div>
    </div>

    <div class="nav">
      <a href="/">Home</a>
      <a href="/categories/">Categories</a>
      <a href="/tags/">Tags</a>
      <a href="/search/">Search</a>
    </div>

    <div class="main content">
      {{ content | safe }}
    </div>

    <div class="footer">© 2026</div>
  </div>
</body>
</html>
